#
# This github action will auto build engineering releases and create a
# release tag with auto-generated release notes
#
# NOTE: This workflow will fail if it is run on a non-tagged commit
#       (See Checkout submodules and Tags section for more info)
#

name: release

# Controls when the workflow will run
on:
  # Triggers the workflow on tags with vX.X.X format (with optional -RC)
  push:
    tags: [ 'v[0-9]+.[0-9]+.[0-9]+', 'v[0-9]+.[0-9]+.[0-9]+-RC[0-9]+' ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build:
    runs-on: [self-hosted, linux]

    defaults:
      run:
        shell: bash -l {0}

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v3

      # Create a tagged release with autogenerated release notes
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          prerelease: True
          generate_release_notes: True
